# Repository overview and developer guide

This document is the hub for repo structure, entry points, and pointers to key files.

## Repository map (folders only)

```
TwitchClipper/ - Repository root
├── .github/ - GitHub settings and automation
│   └── workflows/ - CI workflows and checks (e.g., tests, lint)
├── agents/ - Agent role definitions and domain guidance
├── api/ - FastAPI service
├── backend/ - Backend logic (clip download/processing)
├── cli/ - CLI entry points
├── docs/ - Project documentation templates and guides
├── scripts/ - Setup and utility scripts (e.g. generate_test_media.py)
├── tests/ - Pytest suites
│   └── media/ - Deterministic test videos (generated by scripts/generate_test_media.py)
└── workflows/ - Multi-agent workflow templates
    └── contexts/ - Workflow handoff artifacts
```

## Data files and schemas

- **Primary data** lives in `Not used`
- **Schemas** live in `Not used`
- **Configuration schema** mirrors the runtime config model and drives validation for API/UI inputs

## Backend layout (`backend/`)

- **Configuration**: `Not used`
- **Domain logic**: `backend/clips.py`, `backend/oneVideo.py`, `backend/transition.py`,
  `backend/overlay.py`, `backend/scoring.py` (clip scoring from metadata),
  `backend/clip_models.py` (ClipRef, ClipAsset, JSON sidecar persistence),
  `backend/vod_models.py` (typed data contracts for VOD highlight jobs, chat messages, and segments),
  `backend/chat_spikes.py` (message bucketing and threshold-based spike detection),
  `backend/segment_generator.py` (spike buckets to segment windows with overlap merging),
  `backend/filtering.py` (clip dedupe and max-per-streamer filter),
  `backend/pipeline.py` (scrape → filter → rank → top N → download; PER_STREAMER_K for multi-streamer)
- **Public API**: `Not implemented yet`
- **CLI entrypoint**: `cli/main.py`

## API service (`api/`)

- **FastAPI (job API)**: `api/app.py` — in-memory job queue, clip-montage submit, status, run-next dev helper.
- **Run**: `uvicorn api.app:app --reload`
- **Endpoints**: `GET /health` (ok check), `POST /jobs/clip-montage` (submit job), `GET /jobs/{job_id}` (status), `POST /jobs/run-next` (dev helper: process one queued job).
- CORS/auth/limits: `Not used`

## Frontend (`frontend/` planned)

- App entry: `Not implemented yet (planned React entry)`
- Shared types/utils: `Not used`
- Testing: `Not used`

## Pointers (start here to find things fast)

- `README.md` - Project overview, run commands, and onboarding
- `AGENTS.md` - Coding standards and agent guidance
- `docs/TEMPLATE.md` - Template philosophy and required customizations
- `docs/setup.md` - First-agent setup checklist and placeholder list
- `docs/audit.md` - Placeholder audit tracking
- `docs/architecture.md` - Architecture template (data flow, boundaries, invariants)
- `docs/backend_report.md` - Backend behavior report and risks
- `docs/glossary.md` - Domain terminology quick reference
- `docs/TODO.md` - Prioritized backend fixes and features
- `docs/roadmap.md` - Product roadmap and phased deliverables (highlight generator goal)
- **Test media**: Offline test videos live in `tests/media/` (sample_vod.mp4, sample_clip_1–3.mp4). To regenerate: `python scripts/generate_test_media.py` (requires ffmpeg on PATH; idempotent).
- `CONTRIBUTING.md` - PR checklist and standards
- `.pre-commit-config.yaml` - Formatting and lint hooks
- `.editorconfig` - Whitespace and line ending rules
- `.github/workflows/ci.yml` - CI pipeline and test commands
- `docs/DEPLOYMENT.md` - Deployment strategy and decision matrix
- `docs/DEPLOYMENT_QUICKSTART.md` - Quick deployment steps
- `LICENSE` - License selection placeholder
- `agents/index.md` - Agent role index
- `workflows/README.md` - Workflow system overview
- `workflows/contexts/README.md` - Handoff artifact format
